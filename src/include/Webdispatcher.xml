<?xml version="1.0"?>
<!DOCTYPE profile>
<profile xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns">
<general>
  <ask-list config:type="list">
  
          <ask>
             <title>SAP System Parameters</title>
             <dialog config:type="integer">10</dialog>
             <element config:type="integer">30</element>
             <width config:type="integer">70</width>
             <height config:type="integer">20</height>
             <help><![CDATA[
             <p><b>SAP Master Password</b><br>Enter and repeat the master password for the SAP system.<br>
		The system uses this master password for all accounts created by the installer<br> 
		and for the secure store key phrase.<br>
		The password must fulfill the following requirements:<br>
		- Consists of 8 or 9 characters<br>
		- Contains at least one digit and one lowercase character<br> 
		- It can contain these special characters: #, $, @, _<br>
		- It does not have a digit or an underscore (_) as the first character
	     </p>
	     ]]>
	     </help>
             <file>/tmp/ay_q_masterpass</file>
             <path>users,0,user_password</path>
             <question>SAP Master Password</question>
             <password config:type="boolean">true</password>
             <stage>cont</stage>
             <default></default>
             <script>
                <filename>my_pwd.sh</filename>
                <rerun_on_error config:type="boolean">true</rerun_on_error>
                <environment config:type="boolean">true</environment>
                <source><![CDATA[
function check_masterpwd() {
	local pwd=$( cat /tmp/ay_q_masterpass )

        if [ -z "$pwd" ]; then
		echo "You must provide a master password for your installation!"
		exit 1
        fi
	if [ "${#pwd}" -gt 9 ]; then 
		echo "The master password cannot be longer than 9 chars currently."
		echo "You entered a ${#pwd} chars long password." 
		exit 1
        fi
	if [ "${#pwd}" -lt 8 ]; then
		echo "The master password cannot be shorter than 8 chars."
		echo "You entered a ${#pwd} chars long password."
		exit 1
	fi
        if [ -n "${pwd//[0-9A-Za-z\$@_#]/}" ]; then
		echo "The Password contains forbidden chars."
		echo "Allowed are 0-9, A-Z, a-z and $ @ _ #"
		echo "But you're using: '${pwd//[0-9A-Za-z_@#]/}'."
		exit 1
	fi	
        if [ -z "${pwd//[A-Za-z\$@_#]/}" ]; then
		echo "The Password must at least contain one numeric character 0-9."
		exit 1
        fi
	if [ "${pwd#[_]}" != "$pwd" ]; then
		echo "The Password may not start with a '_'." 
		exit 1
        fi
	if [ "${pwd#[0-9]}" != "$pwd" ]; then
		echo "The Password may not start with a numeric character."
		exit 1
	fi
        exit 0
}
check_masterpwd "$VAL"
]]>
                </source>
                <debug config:type="boolean">false</debug>
                <feedback config:type="boolean">true</feedback>
             </script>
          </ask>
          <ask>
             <title>Internet Connection Framework (ICF)</title>
             <dialog config:type="integer">40</dialog>
             <element config:type="integer">10</element>
             <width config:type="integer">70</width>
             <height config:type="integer">20</height>
             <help><![CDATA[
             <p>The Web Dispatcher uses ICF services of the ABAP system's application servers to retrieve information about server groups and URL mappings. By default, all ICF services are inactive. For more information, see SAP Note 552286.</p>
]]>
</help>
             <question>Activate ICF nodes</question>
             <default>true</default>
             <type>boolean</type>
             <file>/tmp/ay_q_ifc</file>
	  </ask>
          <ask>
             <title>Internet Connection Framework (ICF)</title>
             <dialog config:type="integer">40</dialog>
             <element config:type="integer">20</element>
             <help><![CDATA[
             <p><b>Application Server Host</b><br>Default: Message Server Host</p>
]]>
</help>
             <file>/tmp/ay_q_ifc_host</file>
             <question>Application Server Host</question>
             <stage>cont</stage>
          </ask>
          <ask>
             <title>Internet Connection Framework (ICF)</title>
             <dialog config:type="integer">40</dialog>
             <element config:type="integer">30</element>
             <file>/tmp/ay_q_ifc_in</file>
             <question>Instance Number</question>
             <stage>cont</stage>
             <default>00</default>
          </ask>
          <ask>
             <title>Internet Connection Framework (ICF)</title>
             <dialog config:type="integer">40</dialog>
             <element config:type="integer">40</element>
             <file>/tmp/ay_q_ifc_sapsc</file>
             <question>SAP System Client</question>
             <stage>cont</stage>
          </ask>
          <ask>
             <title>Internet Connection Framework (ICF)</title>
             <dialog config:type="integer">40</dialog>
             <element config:type="integer">50</element>
             <file>/tmp/ay_q_ifc_rfcuser</file>
             <question>RFC User</question>
             <stage>cont</stage>
          </ask>
          <ask>
             <title>Internet Connection Framework (ICF)</title>
             <dialog config:type="integer">40</dialog>
             <element config:type="integer">60</element>
             <file>/tmp/ay_q_ifc_rfcuser_password</file>
             <question>Password of RFC User</question>
	     <stage>cont</stage>
	     <password config:type="boolean">true</password>
          </ask>
          <ask>
             <title>Web Message Server Parameters</title>
             <dialog config:type="integer">60</dialog>
             <element config:type="integer">10</element>
             <width config:type="integer">70</width>
             <height config:type="integer">20</height>
             <file>/tmp/ay_q_ms_host</file>
             <question>Message Server Host</question>
             <stage>cont</stage>
             <help><![CDATA[
             <p>If your system is based on AS ABAP or on AS ABAP and AS Java, enter the parameters of the ABAP message server. If your system is based on AS Java only, enter the parameters of the Java message server.</p>
]]>
</help>
          </ask>
          <ask>
             <title>Web Message Server Parameters</title>
             <dialog config:type="integer">60</dialog>
             <element config:type="integer">20</element>
             <file>/tmp/ay_q_ms_port</file>
             <question>Message Server HTTP Port</question>
             <stage>cont</stage>
          </ask>
<!-- BEGIN ICF-Activation -->

          <ask>
             <title>Internet Connection Framework (ICF)</title>
             <dialog config:type="integer">70</dialog>
             <element config:type="integer">1</element>
             <width config:type="integer">70</width>
             <height config:type="integer">20</height>
             <help><![CDATA[
             <p>The Web Dispatcher uses <b>ICF services</b> of the ABAP system's application servers to retrieve information about server groups and URL mappings. By default, all ICF services are inactive. For more information, see SAP Note 552286.</p>
]]>
</help>
             <file>/tmp/ay_q_icf</file>
             <question>Activate ICF nodes</question>
             <stage>cont</stage>
             <type>boolean</type>
             <script>
               <filename>my_selection_next_dialog.sh</filename>
               <rerun_on_error config:type="boolean">true</rerun_on_error>
               <environment config:type="boolean">true</environment>
               <source><![CDATA[
                 LC_ALL=POSIX

                 # Skip RFC configuration if "false"
                 [ "false" = `< /tmp/ay_q_icf` ] && echo "-1" > /tmp/next_dialog

                 exit 0
                 ]]>
               </source>
               <debug config:type="boolean">false</debug>
               <feedback config:type="boolean">true</feedback>
             </script>
             <default>false</default>
          </ask>

<!-- END ICF-Activation -->
<!-- BEGIN RFC-Configuration -->

          <ask>
             <title>Remote Function Call (RFC) Connection</title>
             <dialog config:type="integer">71</dialog>
             <element config:type="integer">1</element>
             <width config:type="integer">70</width>
             <height config:type="integer">20</height>
             <file>/tmp/ay_q_icf_host</file>
             <question>Application Server Host</question>
             <stage>cont</stage>
             <default></default>
          </ask>

          <ask>
             <title>Remote Function Call (RFC) Connection</title>
             <dialog config:type="integer">71</dialog>
             <element config:type="integer">2</element>
             <file>/tmp/ay_q_icf_in</file>
             <question>Instance Number</question>
             <stage>cont</stage>
             <default></default>
          </ask>

          <ask>
             <title>Remote Function Call (RFC) Connection</title>
             <dialog config:type="integer">71</dialog>
             <element config:type="integer">3</element>
             <file>/tmp/ay_q_icf_sapsc</file>
             <question>SAP System Client</question>
             <stage>cont</stage>
             <default>000</default>
          </ask>

          <ask>
             <title>Remote Function Call (RFC) Connection</title>
             <dialog config:type="integer">71</dialog>
             <element config:type="integer">4</element>
             <file>/tmp/ay_q_icf_rfcuser</file>
             <question>RFC User</question>
             <stage>cont</stage>
             <default>DDIC</default>
          </ask>

          <ask>
             <title>Remote Function Call (RFC) Connection</title>
             <dialog config:type="integer">71</dialog>
             <element config:type="integer">5</element>
             <file>/tmp/ay_q_icf_rfcuser_password</file>
             <question>Password of RFC User</question>
             <stage>cont</stage>
             <default></default>
          </ask>

<!-- END RFC-Configuration -->
          <ask>
             <title>Web Dispatcher Parameters</title>
             <dialog config:type="integer">50</dialog>
             <element config:type="integer">10</element>
             <width config:type="integer">70</width>
             <height config:type="integer">20</height>
             <help><![CDATA[
             <p><b>Web Dispatcher Instance Number</b><br>The Instance Number for the Web Dispatcher instance is a technical identifier for controlling internal processes (such as assigned memory). This number must be unique for this installation host.</p>
]]>
</help>
             <file>/tmp/ay_q_wd_nr</file>
             <question>Web Dispatcher Instance Number</question>
             <stage>cont</stage>
             <script>
              <filename>my_wd_ino.sh</filename>
              <rerun_on_error config:type="boolean">true</rerun_on_error>
              <environment config:type="boolean">true</environment>
              <source><![CDATA[
function check_instance_no() {
        local ino=$1

        LC_ALL=POSIX

        [ -z "$ino" ] && echo "You need to provide a Gateway Instance Number." && return 1
        [ "${#ino}" -ne 2 ] && echo "The Gateway Instance Number needs to be exactly 2 digits long. You entered '${ino}'." && return 1
        [ -n "${ino//[0-9]/}" ] && echo "The SAP Instance Number can only contain digits. You entered '${ino}'." && return 1

        return 0
}
check_instance_no "$VAL"
]]>
              </source>
              <debug config:type="boolean">false</debug>
              <feedback config:type="boolean">true</feedback>
            </script>
            <default>00</default>
          </ask>
          <ask>
             <title>Web Dispatcher Parameters</title>
             <dialog config:type="integer">50</dialog>
             <element config:type="integer">20</element>
             <file>/tmp/ay_q_wd_port</file>
             <question>HTTP Port (leave empty for default)</question>
             <stage>cont</stage>
          </ask>
          <ask>
             <title>Web Dispatcher Parameters</title>
             <dialog config:type="integer">50</dialog>
             <element config:type="integer">30</element>
             <help><![CDATA[
             <p><b>T-Shirt Size</b><br>Select one of the SAP system's T-Shirt sizes.</p>
]]>
</help>
             <file>/tmp/ay_q_wd_ts</file>
             <question>Create configuration for system of size</question>
             <stage>cont</stage>
             <selection config:type="list">
               <entry>
                 <value>S</value>
                 <label>S: Configure the Web Dispatcher for a small footprint.</label>
               </entry>
               <entry>
                 <value>M</value>
                 <label>M: Configure the Web Dispatcher for a medium sized server.</label>
               </entry>
               <entry>
                 <value>L</value>
                 <label>L: Configure the Web Dispatcher for a larger server.</label>
               </entry>
             </selection>
             <default>M</default>
          </ask>
 </ask-list>
</general>
<software>
  <post-patterns config:type="list">
    <pattern>sap-nw</pattern>
  </post-patterns>
</software>
</profile>

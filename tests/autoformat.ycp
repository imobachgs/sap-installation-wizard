{
        import "XML";
        import "Stage";
        import "Storage";
        import "StorageSettings";
        import "Mode";
        import "AutoinstStorage";
	import "AutoinstLVM";
        import "UI";
        import "Wizard";
        textdomain "autoinst";
        map<string,any> profile = $[];
	list args = WFM::Args();
	if(size(args) == 0 )
	{
		y2error("No argument for the partitioning");
		return nil;
	}

	//Read the proposed XML
	profile = XML::XMLToYCPFile(args[0]:"");
	y2milestone("Read Partitioning profile %1",profile);
        Stage::Set("initial");
        Mode::SetMode("autoinstallation");
        Wizard::CreateDialog();
        AutoinstStorage::Import(profile["partitioning"]:[]);
        AutoinstStorage::Write();
    if (AutoinstLVM::Init())
    {
        AutoinstLVM::Write();
    }
y2milestone("AutoinstStorage has closed his work");
	Storage::CommitChanges();
	Storage::WriteFstab();
    Storage::SaveUsedFs();
    StorageSettings::Save();
        UI::CloseDialog();
}
